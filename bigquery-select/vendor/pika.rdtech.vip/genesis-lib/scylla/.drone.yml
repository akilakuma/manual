workspace:
  base: /go
  path: src/${DRONE_REPO_NAME}

kind: pipeline
name: lib
clone:
  skip_verify: true

services:
- name: cassandra
  image: scylladb/scylla:3.2.1
  command: ["--experimental", "1", "--smp", "1", "--cpuset", "1", "--listen-address", "cassandra"]

steps:
- name: "golang_test"
  image: golang:1.14
  commands:
    - sleep 50
    - GO111MODULE=on go get -insecure ./...
    - GO111MODULE=on go test -cover